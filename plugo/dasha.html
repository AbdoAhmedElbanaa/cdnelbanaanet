<!DOCTYPE html>
<html lang="ar" dir="rtl" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Plugo AI</title>
    
    <!-- Ø§Ù„Ø®Ø·ÙˆØ· ÙˆØ§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª ÙˆØ§Ù„Ù…ÙƒØªØ¨Ø§Øª -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* =========================================
           Global Styles & Variables
           ========================================= */
        :root[data-theme='dark'] { 
            --bg-primary: #0f172a; 
            --bg-secondary: #1e293b; 
            --text-main: #f1f5f9; 
            --text-dim: #94a3b8; 
            --accent: #38bdf8; 
            --accent-glow: rgba(56, 189, 248, 0.5);
            --border: rgba(255, 255, 255, 0.1); 
            --toast-bg: rgba(15, 23, 42, 0.95); 
        }
        :root[data-theme='light'] { 
            --bg-primary: #f8fafc; 
            --bg-secondary: #ffffff; 
            --text-main: #0f172a; 
            --text-dim: #64748b; 
            --accent: #0ea5e9; 
            --accent-glow: rgba(14, 165, 233, 0.3);
            --border: #e2e8f0; 
            --toast-bg: rgba(255, 255, 255, 0.95); 
        }
        
        body { 
            font-family: 'Tajawal', sans-serif; 
            background-color: var(--bg-primary); 
            color: var(--text-main); 
            transition: background-color 0.4s, color 0.4s; 
            overflow-x: hidden; 
        }
        
        /* Glass Effect Cards */
        .glass-card { 
            background-color: var(--bg-secondary); 
            border: 1px solid var(--border); 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); 
        }

        /* Navigation Active State */
        .active-nav { 
            background: linear-gradient(135deg, var(--accent), #6366f1); 
            color: white !important; 
            box-shadow: 0 4px 15px var(--accent-glow); 
        }
        
        /* Sidebar Transitions */
        .sidebar { transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        @media (max-width: 768px) { 
            .sidebar { position: fixed; transform: translateX(100%); z-index: 50; top: 0; right: 0; height: 100%; } 
            .sidebar.open { transform: translateX(0); } 
            .overlay { display: none; }
            .overlay.open { display: block; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 40; }
        }
        
        /* Utility Classes */
        .code-badge { 
            font-family: 'Courier New', monospace; 
            background: rgba(56, 189, 248, 0.1); 
            color: var(--accent); 
            padding: 4px 10px; 
            border-radius: 6px; 
            font-weight: bold; 
            cursor: pointer; 
            border: 1px solid rgba(56, 189, 248, 0.2); 
            transition: 0.2s; 
            user-select: all;
        }
        .code-badge:hover { background: rgba(56, 189, 248, 0.2); }

        /* Loader */
        #ui-loader { 
            position: fixed; inset: 0; background: var(--bg-primary); 
            z-index: 1000; display: none; align-items: center; 
            justify-content: center; backdrop-filter: blur(5px); opacity: 0.9;
        }
        
        /* Animations */
        .animate-fade-up { animation: fadeInUp 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Toast Notifications */
        #toast-container { 
            position: fixed; top: 24px; left: 50%; transform: translateX(-50%); 
            z-index: 2000; display: flex; flex-direction: column; gap: 10px; pointer-events: none; 
        }
        .toast-card { 
            pointer-events: auto; min-width: 320px; background: var(--toast-bg); 
            backdrop-filter: blur(16px); border: 1px solid var(--border); 
            padding: 16px 24px; border-radius: 16px; 
            box-shadow: 0 20px 40px rgba(0,0,0,0.2); 
            display: flex; align-items: center; gap: 14px; 
            animation: toastIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; 
        }
        .toast-card.hide { animation: toastOut 0.4s ease forwards; }
        @keyframes toastIn { from { opacity: 0; transform: translateY(-40px) scale(0.9); } to { opacity: 1; transform: translateY(0) scale(1); } }
        @keyframes toastOut { to { opacity: 0; transform: translateY(-20px) scale(0.95); } }

        /* Login Screen Deluxe Styles */
        .login-wrapper { background: radial-gradient(circle at top left, #0f172a, #020617); position: relative; overflow: hidden; min-height: 100vh; }
        .shape-1 { position: absolute; top: -10%; right: -10%; width: 500px; height: 500px; background: radial-gradient(circle, #38bdf8 0%, transparent 70%); filter: blur(80px); opacity: 0.6; animation: pulse 8s infinite; }
        .shape-2 { position: absolute; bottom: -10%; left: -10%; width: 400px; height: 400px; background: radial-gradient(circle, #818cf8 0%, transparent 70%); filter: blur(80px); opacity: 0.6; }
        @keyframes pulse { 0%, 100% { opacity: 0.6; transform: scale(1); } 50% { opacity: 0.4; transform: scale(1.1); } }

        /* Gradients */
        .icon-gradient-blue { background: linear-gradient(135deg, #38bdf8, #2563eb); }
        .icon-gradient-purple { background: linear-gradient(135deg, #a855f7, #7c3aed); }
        .icon-gradient-emerald { background: linear-gradient(135deg, #34d399, #059669); }
        .icon-gradient-rose { background: linear-gradient(135deg, #fb7185, #e11d48); }
        .icon-gradient-red { background: linear-gradient(135deg, #ef4444, #b91c1c); }
    </style>
</head>
<body class="min-h-screen">

    <!-- Root App Container -->
    <div id="app"></div>

    <!-- UI Overlay (Mobile Sidebar) -->
    <div id="overlay" class="overlay" onclick="toggleSidebar()"></div>

    <!-- Static Elements -->
    <div id="ui-loader">
        <div class="flex flex-col items-center gap-4">
            <div class="w-12 h-12 border-4 border-[var(--accent)] border-t-transparent rounded-full animate-spin"></div>
            <p class="font-bold text-[var(--text-main)] text-sm tracking-wide">Plugo AI Dashboard</p>
        </div>
    </div>
    <div id="toast-container"></div>

    <script>
        // ============================================
        // 1. Configuration & State Management
        // ============================================
        const CONFIG = {
            SCRIPT_URL: "https://script.google.com/macros/s/AKfycbzzphGByU8izIrzux7cGsvq3BVBA6sE7s6ehHIwhaNOQe_qfXe3Pupql99feo3vncsf/exec"
        };
        
        const state = {
            view: 'login', // login, dashboard, banned, no-products
            activeSection: 'overview', // overview, blogs, products
            user: null,
            blogs: [],
            theme: localStorage.getItem('theme') || 'dark',
            sidebarOpen: false,
            // Helper to update state and re-render
            update(newState) {
                Object.assign(this, newState);
                renderApp();
            }
        };

        // ============================================
        // 2. Component Generators (Functions returning HTML strings)
        // ============================================
        
        const Components = {
            // Login View
            LoginView: () => `
                <div class="flex items-center justify-center min-h-screen login-wrapper">
                    <div class="shape-1"></div>
                    <div class="shape-2"></div>
                    <div class="bg-[rgba(15,23,42,0.6)] backdrop-blur-xl border border-white/10 rounded-[2.5rem] p-10 md:p-16 max-w-md w-full mx-4 shadow-2xl animate-fade-up z-10">
                        <div class="text-center mb-12">
                            <div class="w-24 h-24 mx-auto bg-slate-900/50 border border-slate-700/50 rounded-3xl flex items-center justify-center mb-6 shadow-xl relative overflow-hidden">
                                <div class="absolute inset-0 bg-sky-500/20 blur-xl"></div>
                                <i data-lucide="shield-check" class="w-12 h-12 text-sky-400 relative z-10"></i>
                            </div>
                            <h1 class="text-5xl font-black mb-3 text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-400 tracking-tight">Plugo AI</h1>
                            <p class="text-slate-400 font-medium text-sm">Ø¨ÙˆØ§Ø¨Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ ÙˆØ§Ù„Ø¹Ù…Ù„Ø§Ø¡</p>
                        </div>
                        <div class="space-y-6">
                            <div>
                                <label class="block text-xs font-bold text-slate-400 mb-2 mr-1">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                                <div class="relative group">
                                    <input type="email" id="login-email" placeholder="name@example.com" class="w-full bg-white/5 border border-white/10 rounded-2xl py-4 px-4 pr-12 text-white placeholder-slate-500 outline-none focus:border-sky-500 focus:bg-white/10 transition-all text-left" dir="ltr">
                                    <i data-lucide="mail" class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-500 group-focus-within:text-sky-400 transition-colors w-5 h-5"></i>
                                </div>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-400 mb-2 mr-1">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± / ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø®ÙˆÙ„</label>
                                <div class="relative group">
                                    <input type="password" id="login-password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" class="w-full bg-white/5 border border-white/10 rounded-2xl py-4 px-4 pr-12 text-white placeholder-slate-500 outline-none focus:border-sky-500 focus:bg-white/10 transition-all text-left" dir="ltr">
                                    <i data-lucide="lock" class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-500 group-focus-within:text-sky-400 transition-colors w-5 h-5"></i>
                                </div>
                            </div>
                            <button onclick="Actions.login()" class="w-full bg-gradient-to-br from-sky-400 to-blue-600 hover:from-sky-300 hover:to-blue-500 text-white py-5 rounded-2xl font-bold shadow-lg shadow-sky-500/20 flex items-center justify-center gap-3 mt-4 text-lg group transition-all transform hover:-translate-y-1">
                                <span>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</span>
                                <i data-lucide="arrow-left" class="w-5 h-5 group-hover:-translate-x-1 transition-transform"></i>
                            </button>
                        </div>
                        <div class="mt-8 text-center border-t border-white/5 pt-6">
                            <p class="text-slate-500 text-xs font-medium">Ù…Ø­Ù…ÙŠ Ø¨ÙˆØ§Ø³Ø·Ø© Ø£Ù†Ø¸Ù…Ø© Plugo AI Ø§Ù„Ø£Ù…Ù†ÙŠØ© &copy; 2025</p>
                        </div>
                    </div>
                </div>
            `,

            // Banned View
            BannedView: () => `
                <div class="flex items-center justify-center min-h-screen bg-slate-950 p-6 relative overflow-hidden">
                    <div class="absolute inset-0 bg-[radial-gradient(circle_at_center,_#450a0a_0%,_#0f172a_70%)] opacity-50"></div>
                    <div class="glass-card rounded-[3rem] p-10 md:p-14 max-w-md w-full animate-fade-up text-center relative border-red-500/30 backdrop-blur-xl">
                        <div class="w-24 h-24 icon-gradient-red rounded-full flex items-center justify-center mx-auto mb-8 shadow-[0_0_50px_rgba(239,68,68,0.4)] animate-pulse">
                            <i data-lucide="ban" class="w-12 h-12 text-white"></i>
                        </div>
                        <h2 class="text-3xl font-black mb-4 text-red-100">Ø­Ø³Ø§Ø¨ Ù…Ø­Ø¸ÙˆØ±</h2>
                        <p class="text-red-200/70 font-bold leading-relaxed mb-8 text-sm">ØªÙ… ØªØ¹Ù„ÙŠÙ‚ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø­Ø³Ø§Ø¨Ùƒ Ø­Ø§Ù„ÙŠØ§Ù‹ Ù„Ù…Ø®Ø§Ù„ÙØ© Ø§Ù„Ø´Ø±ÙˆØ·.</p>
                        <button onclick="Actions.logout()" class="w-full py-4 rounded-2xl font-black bg-red-500/20 hover:bg-red-500/30 text-red-200 border border-red-500/20 transition-all flex items-center justify-center gap-3">
                            <i data-lucide="log-out" size="18"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
                        </button>
                    </div>
                </div>
            `,

            // No Products View
            NoProductsView: () => `
                <div class="flex items-center justify-center min-h-screen bg-slate-950 p-6">
                    <div class="glass-card rounded-[3rem] p-10 md:p-14 max-w-md w-full animate-fade-up text-center relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-rose-500 to-orange-500"></div>
                        <div class="w-24 h-24 icon-gradient-rose rounded-full flex items-center justify-center mx-auto mb-8 shadow-2xl shadow-rose-500/30">
                            <i data-lucide="shopping-cart" class="w-10 h-10 text-white"></i>
                        </div>
                        <h2 class="text-3xl font-black mb-4">Ù†Ø¹ØªØ°Ø± Ù…Ù†Ùƒ <span class="text-rose-400">${state.user?.name.split(' ')[0] || ''}</span></h2>
                        <p class="text-slate-400 font-bold leading-relaxed mb-8">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙŠ Ù…Ù†ØªØ¬Ø§Øª Ø£Ùˆ Ù‚ÙˆØ§Ù„Ø¨ Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø­Ø³Ø§Ø¨Ùƒ Ø­Ø§Ù„ÙŠØ§Ù‹.</p>
                        <button onclick="Actions.logout()" class="w-full py-4 rounded-2xl font-black bg-white/5 hover:bg-white/10 text-white border border-white/10 transition-all flex items-center justify-center gap-3">
                            <i data-lucide="log-out" size="18"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
                        </button>
                    </div>
                </div>
            `,

            // Sidebar Component
            Sidebar: () => {
                const user = state.user || {};
                const avatar = user.avatar || `https://ui-avatars.com/api/?name=${encodeURIComponent(user.name || 'User')}&background=38bdf8&color=fff`;
                const email = JSON.parse(localStorage.getItem('plugo_user_session') || '{}').email || '';
                
                const navItem = (id, icon, label) => `
                    <button onclick="Actions.setSection('${id}')" class="w-full flex items-center gap-4 px-6 py-4 rounded-2xl font-bold transition-all ${state.activeSection === id ? 'active-nav' : 'hover:bg-white/5'}">
                        <i data-lucide="${icon}"></i> ${label}
                    </button>
                `;

                return `
                    <aside id="sidebar" class="sidebar w-80 bg-[var(--bg-secondary)] border-l border-[var(--border)] p-8 flex flex-col h-screen fixed md:relative ${state.sidebarOpen ? 'open' : ''}">
                        <div class="flex items-center justify-between mb-16">
                            <div class="flex items-center gap-4">
                                <div class="w-10 h-10 icon-gradient-blue rounded-xl flex items-center justify-center text-white font-black shadow-lg shadow-sky-500/20">P</div>
                                <h2 class="text-2xl font-black">Plugo AI</h2>
                            </div>
                            <button class="md:hidden" onclick="toggleSidebar()"><i data-lucide="x"></i></button>
                        </div>
                        <nav class="flex-grow space-y-3">
                            ${navItem('overview', 'layout-dashboard', 'Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©')}
                            ${navItem('blogs', 'globe', 'Ø§Ù„ØªÙØ¹ÙŠÙ„Ø§Øª')}
                            ${navItem('products', 'download', 'Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª')}
                        </nav>
                        <div class="mt-auto pt-8 border-t border-[var(--border)]">
                            <div class="flex items-center gap-4 p-4 bg-white/5 rounded-[2rem] mb-6 overflow-hidden text-right">
                                <img src="${avatar}" class="w-10 h-10 rounded-full border-2 border-sky-500">
                                <div class="overflow-hidden">
                                    <p class="text-sm font-black truncate">${user.name}</p>
                                    <p class="text-[10px] opacity-70 truncate" dir="ltr">${email}</p>
                                </div>
                            </div>
                            <button onclick="Actions.logout()" class="w-full flex items-center gap-3 p-4 text-red-400 font-black text-sm hover:bg-red-500/10 rounded-2xl transition-colors">
                                <i data-lucide="log-out"></i> Ø®Ø±ÙˆØ¬
                            </button>
                        </div>
                    </aside>
                `;
            },

            // Overview Section Component
            OverviewSection: () => {
                const uniqueProds = Helpers.getUniqueProducts();
                const blogs = state.blogs || [];
                
                const statCard = (icon, grad, val, label) => `
                    <div class="glass-card p-8 rounded-[2.5rem] flex items-center gap-6 group hover:-translate-y-1 transition-transform">
                        <div class="w-16 h-16 ${grad} rounded-2xl flex items-center justify-center text-white shadow-xl"><i data-lucide="${icon}" size="28"></i></div>
                        <div class="text-right">
                            <p class="text-[var(--text-dim)] text-xs font-black mb-1">${label}</p>
                            <h5 class="text-3xl font-black">${val}</h5>
                        </div>
                    </div>
                `;

                const activityList = blogs.length === 0 
                    ? '<div class="p-20 text-center opacity-50 italic">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù†Ø´Ø·Ø© Ù…Ø³Ø¬Ù„Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.</div>' 
                    : [...blogs].reverse().map(b => `
                        <div class="p-6 flex flex-col md:flex-row items-center justify-between border-b border-[var(--border)] last:border-0 hover:bg-white/[0.02] transition-colors">
                            <div class="flex items-center gap-4 mb-4 md:mb-0 w-full md:w-auto">
                                <div class="w-12 h-12 bg-sky-500/10 rounded-xl flex items-center justify-center text-sky-400 shrink-0"><i data-lucide="key"></i></div>
                                <div class="text-right overflow-hidden">
                                    <p class="font-black truncate">${b.blogname}</p>
                                    <p class="text-[10px] text-emerald-400 font-bold">ØªÙØ¹ÙŠÙ„ Ù†Ø´Ø·</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-4 w-full md:w-auto justify-end">
                                <p class="font-black text-sky-400 font-mono text-sm sm:text-base" dir="ltr">${b.licenseCode}</p>
                                <button onclick="Helpers.copy('${b.licenseCode}')" class="p-3 bg-sky-500 text-white rounded-xl shadow-lg hover:scale-105 transition-transform"><i data-lucide="copy" size="18"></i></button>
                            </div>
                        </div>
                    `).join('');

                return `
                    <section class="animate-fade-up">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12">
                            ${statCard('shield-check', 'icon-gradient-blue', `${blogs.length} / ${state.user.maxActivations}`, 'Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©')}
                            ${statCard('shopping-cart', 'icon-gradient-purple', uniqueProds.length, 'Ù‚ÙˆØ§Ù„Ø¨Ùƒ Ø§Ù„Ù…ØªØ§Ø­Ø©')}
                            ${statCard('globe', 'icon-gradient-emerald', blogs.length, 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙˆÙ†Ø§Øª')}
                        </div>
                        <h4 class="text-xl font-black mb-6 text-right">Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø©</h4>
                        <div class="glass-card rounded-[2.5rem] overflow-hidden">
                            ${activityList}
                        </div>
                    </section>
                `;
            },

            // Blogs Section Component
            BlogsSection: () => {
                const blogList = state.blogs.length === 0 
                    ? '<p class="text-center opacity-30 py-10">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙØ¹ÙŠÙ„Ø§Øª Ù…Ø³Ø¬Ù„Ø©.</p>' 
                    : state.blogs.map(b => `
                        <div class="flex flex-col md:flex-row items-center justify-between p-4 bg-white/5 rounded-2xl border border-[var(--border)] animate-fade-up gap-4">
                            <div class="truncate text-right w-full md:w-auto">
                                <p class="text-sm font-black">${b.blogname}</p>
                                <p class="text-[10px] text-sky-400 font-mono mt-1" dir="ltr">${b.blogid}</p>
                            </div>
                            <div class="flex items-center gap-3 w-full md:w-auto justify-end">
                                <div onclick="Helpers.copy('${b.licenseCode}')" class="code-badge text-[10px] sm:text-xs select-all">${b.licenseCode}</div>
                                <button onclick="Actions.deleteBlog('${b.blogid}')" class="p-2 text-red-400 hover:bg-red-400/10 rounded-lg transition-colors"><i data-lucide="trash-2" size="16"></i></button>
                            </div>
                        </div>
                    `).join('');

                return `
                    <section class="animate-fade-up text-right">
                        <div class="glass-card rounded-[3rem] p-8 md:p-10 mb-8">
                            <h4 class="text-2xl font-black mb-8">ØªÙØ¹ÙŠÙ„ Ù‚Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</h4>
                            <div class="flex flex-col lg:flex-row gap-5">
                                <input id="blog-id-input" type="text" placeholder="Blog ID (Ù…Ø«Ø§Ù„: 14393793...)" class="flex-grow p-5 rounded-2xl font-bold text-right bg-white/5 border border-[var(--border)] text-[var(--text-main)] outline-none focus:border-[var(--accent)]" dir="ltr">
                                <button onclick="Actions.searchBlog()" class="bg-sky-500 text-white px-10 py-5 rounded-2xl font-black hover:bg-sky-600 transition-colors shadow-lg shadow-sky-500/20 whitespace-nowrap">ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø¯ÙˆÙ†Ø©</button>
                            </div>
                            <div id="search-result-box" class="hidden mt-10 p-8 border-2 border-dashed border-sky-400/30 rounded-[2.5rem] bg-sky-400/5 animate-fade-up">
                                <div class="flex flex-col md:flex-row justify-between items-center gap-6">
                                    <div class="text-right">
                                        <h5 id="result-name" class="text-2xl md:text-3xl font-black"></h5>
                                        <p id="result-url" class="text-sky-400 font-bold mt-2 truncate max-w-xs" dir="ltr"></p>
                                    </div>
                                    <button onclick="Actions.registerBlog()" class="bg-[var(--text-main)] text-[var(--bg-primary)] px-12 py-5 rounded-2xl font-black shadow-xl hover:scale-105 transition-all whitespace-nowrap">ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ±Ø®ÙŠØµ Ø§Ù„Ø¢Ù†</button>
                                </div>
                            </div>
                        </div>

                        <div class="glass-card rounded-[3rem] p-8 md:p-10">
                            <h4 class="text-xl font-black mb-8">Ù…Ø¯ÙˆÙ†Ø§ØªÙƒ Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</h4>
                            <div class="space-y-4">${blogList}</div>
                        </div>
                    </section>
                `;
            },

            // Products Section Component
            ProductsSection: () => {
                const uniqueProds = Helpers.getUniqueProducts();
                
                const productCard = (p) => `
                    <div class="glass-card rounded-[2.5rem] overflow-hidden animate-fade-up flex flex-col">
                        <div class="relative h-48 overflow-hidden bg-slate-800">
                            <img src="${p.image}" class="w-full h-full object-cover opacity-60 hover:opacity-80 transition-opacity duration-500">
                            <div class="absolute inset-0 bg-gradient-to-t from-[var(--bg-secondary)] to-transparent"></div>
                            <div class="absolute bottom-6 right-6 left-6 flex justify-between items-end">
                                <h4 class="text-2xl font-black text-white drop-shadow-lg">${p.name}</h4>
                                <span class="bg-emerald-500 text-white font-black px-3 py-1 rounded-lg text-[10px] shadow-lg">Ù…ÙØ¹Ù‘Ù„</span>
                            </div>
                        </div>
                        <div class="p-8 text-right flex-grow flex flex-col">
                            <p class="text-[var(--text-dim)] mb-6 font-bold text-sm leading-relaxed flex-grow">${p.desc || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ Ù…ØªØ§Ø­.'}</p>
                            <div class="flex flex-wrap gap-3 justify-end mt-auto">
                                ${(p.versions || ["V1.0.0"]).map(v => `
                                    <button onclick="Actions.download('${p.link || '#'}', '${v}')" class="bg-sky-500 hover:bg-sky-600 text-white px-5 py-3 rounded-xl transition-all font-black text-[11px] flex items-center gap-2 shadow-lg shadow-sky-500/20">
                                        <i data-lucide="download" size="14"></i> ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥ØµØ¯Ø§Ø± ${v}
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;

                return `
                    <section class="animate-fade-up">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            ${uniqueProds.length === 0 
                                ? '<p class="text-center opacity-30 py-20 col-span-full font-bold">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…ØªØ§Ø­Ø© Ù„Ù„ØªØ­Ù…ÙŠÙ„ Ø­Ø§Ù„ÙŠØ§Ù‹.</p>' 
                                : uniqueProds.map(productCard).join('')}
                        </div>
                    </section>
                `;
            },

            // Main Dashboard Container
            Dashboard: () => `
                <div class="flex flex-col md:flex-row min-h-screen">
                    ${Components.Sidebar()}
                    <main class="flex-grow p-6 md:p-12 overflow-y-auto w-full">
                        <header class="flex justify-between items-center mb-12">
                            <div class="text-right">
                                <h3 class="text-3xl font-black">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h3>
                                <p class="text-slate-500 font-bold">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒØŒ ${state.user.name.split(' ')[0]} ğŸ‘‹</p>
                            </div>
                            <div class="flex gap-3">
                                <button onclick="toggleSidebar()" class="md:hidden p-4 rounded-2xl border border-[var(--border)] glass-card">
                                    <i data-lucide="layout-dashboard" class="text-sky-400"></i>
                                </button>
                                <button onclick="Actions.toggleTheme()" class="p-4 rounded-2xl border border-[var(--border)] glass-card hover:bg-[var(--accent)]/10 transition-colors">
                                    <i data-lucide="${state.theme === 'dark' ? 'sun' : 'moon'}" class="text-sky-400"></i>
                                </button>
                            </div>
                        </header>
                        
                        ${state.activeSection === 'overview' ? Components.OverviewSection() : ''}
                        ${state.activeSection === 'blogs' ? Components.BlogsSection() : ''}
                        ${state.activeSection === 'products' ? Components.ProductsSection() : ''}
                    </main>
                </div>
            `
        };

        // ============================================
        // 3. Logic & Actions
        // ============================================
        
        const Helpers = {
            toast(msg, type = 'success') {
                const container = document.getElementById('toast-container');
                const toast = document.createElement('div');
                const icons = { success: 'check-circle', error: 'alert-circle', loading: 'loader-2' };
                const color = type === 'success' ? 'text-emerald-400' : (type === 'error' ? 'text-red-400' : 'text-sky-400 animate-spin');
                
                toast.className = 'toast-card';
                toast.innerHTML = `<i data-lucide="${icons[type]}" class="${color}"></i><span class="font-bold text-sm text-[var(--text-main)]">${msg}</span>`;
                container.appendChild(toast);
                lucide.createIcons();

                const remove = () => { toast.classList.add('hide'); setTimeout(() => toast.remove(), 400); };
                if (type !== 'loading') setTimeout(remove, 4000);
                return { close: remove };
            },
            toggleLoader(show) { document.getElementById('ui-loader').style.display = show ? 'flex' : 'none'; },
            getUniqueProducts() {
                if (!state.user) return [];
                const unique = new Map();
                const add = (p) => { if(p && p.name) unique.set(p.name, p); };
                (Array.isArray(state.user.products) ? state.user.products : [state.user.products]).forEach(add);
                state.blogs.forEach(b => add(b.productData));
                return Array.from(unique.values());
            },
            copy(text) {
                navigator.clipboard.writeText(text);
                Helpers.toast("ğŸ“‹ ØªÙ… Ù†Ø³Ø® ÙƒÙˆØ¯ Ø§Ù„ØªØ±Ø®ÙŠØµ!");
            },
            jsonp(id) {
                return new Promise((resolve, reject) => {
                    const cb = 'bloggerCallback_' + Math.floor(Math.random() * 1000000);
                    window[cb] = (data) => { delete window[cb]; document.getElementById(cb)?.remove(); data?.feed ? resolve(data) : reject(); };
                    const s = document.createElement('script'); s.id = cb; s.src = `https://www.blogger.com/feeds/${id}/posts/default?alt=json-in-script&callback=${cb}`;
                    s.onerror = () => { delete window[cb]; reject(); };
                    document.body.appendChild(s);
                });
            }
        };

        const Actions = {
            async login() {
                const email = document.getElementById('login-email').value;
                const pass = document.getElementById('login-password').value;
                if(!email || !pass) return Helpers.toast("âš ï¸ ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© ÙƒØ§ÙØ© Ø§Ù„Ø­Ù‚ÙˆÙ„", "error");

                Helpers.toggleLoader(true);
                try {
                    const res = await fetch(`${CONFIG.SCRIPT_URL}?action=login&email=${encodeURIComponent(email)}&password=${encodeURIComponent(pass)}`);
                    const result = await res.json();
                    
                    if (result.status === 'banned') return state.update({ view: 'banned' });
                    
                    if (result.status === 'success') {
                        localStorage.setItem('plugo_user_session', JSON.stringify({ email, password: pass }));
                        state.user = result.meta;
                        state.blogs = result.blogs || [];
                        const hasProducts = Helpers.getUniqueProducts().length > 0;
                        state.update({ view: hasProducts ? 'dashboard' : 'no-products' });
                        Helpers.toast("âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­");
                    } else {
                        Helpers.toast("âŒ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©", "error");
                    }
                } catch(e) { Helpers.toast("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„", "error"); }
                finally { Helpers.toggleLoader(false); }
            },
            logout() {
                localStorage.removeItem('plugo_user_session');
                state.update({ user: null, blogs: [], view: 'login' });
            },
            setSection(section) {
                state.update({ activeSection: section, sidebarOpen: false });
            },
            toggleTheme() {
                const newTheme = state.theme === 'dark' ? 'light' : 'dark';
                state.update({ theme: newTheme });
                localStorage.setItem('theme', newTheme);
            },
            async searchBlog() {
                const id = document.getElementById('blog-id-input').value;
                if(!id) return Helpers.toast("âš ï¸ Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¹Ø±Ù Ø£ÙˆÙ„Ø§Ù‹", "error");
                if(state.blogs.some(b => b.blogid == id)) return Helpers.toast("ğŸš« Ø§Ù„Ù…Ø¯ÙˆÙ†Ø© Ù…Ø³Ø¬Ù„Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹", "error");

                const loader = Helpers.toast("ğŸ” Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...", "loading");
                try {
                    const data = await Helpers.jsonp(id);
                    state.searchResult = { 
                        blogid: id, 
                        blogname: data.feed.title.$t, 
                        blogurl: data.feed.link.find(l => l.rel === 'alternate')?.href 
                    };
                    document.getElementById('result-name').innerText = state.searchResult.blogname;
                    document.getElementById('result-url').innerText = state.searchResult.blogurl;
                    document.getElementById('search-result-box').classList.remove('hidden');
                    loader.close();
                    Helpers.toast("âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¯ÙˆÙ†Ø©");
                } catch(e) { loader.close(); Helpers.toast("âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¯ÙˆÙ†Ø©", "error"); }
            },
            async registerBlog() {
                if(state.blogs.length >= state.user.maxActivations) return Helpers.toast("âš ï¸ ØªØ¬Ø§ÙˆØ²Øª Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰", "error");
                const loader = Helpers.toast("ğŸš€ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙØ¹ÙŠÙ„...", "loading");
                const session = JSON.parse(localStorage.getItem('plugo_user_session'));
                const payload = {
                    action: 'add',
                    ...state.searchResult,
                    licenseCode: `PLUGO-${Math.random().toString(36).substr(2, 4).toUpperCase()}-${Math.random().toString(36).substr(2, 4).toUpperCase()}`,
                    userName: state.user.name,
                    userEmail: session.email
                };

                try {
                    const res = await fetch(CONFIG.SCRIPT_URL, { method: 'POST', body: JSON.stringify(payload) });
                    const result = await res.json();
                    loader.close();
                    if(result.result === 'success') {
                        Helpers.toast("ğŸ‰ ØªÙ… Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!");
                        Actions.refreshData(session.email, session.password);
                    } else Helpers.toast("âŒ ÙØ´Ù„ Ø§Ù„ØªÙØ¹ÙŠÙ„", "error");
                } catch(e) { loader.close(); Helpers.toast("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„", "error"); }
            },
            async deleteBlog(id) {
                if(!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ")) return;
                const loader = Helpers.toast("ğŸ—‘ï¸ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­Ø°Ù...", "loading");
                const session = JSON.parse(localStorage.getItem('plugo_user_session'));
                try {
                    await fetch(CONFIG.SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'delete', blogid: id, userEmail: session.email }) });
                    loader.close();
                    Helpers.toast("âœ… ØªÙ… Ø§Ù„Ø­Ø°Ù");
                    Actions.refreshData(session.email, session.password);
                } catch(e) { loader.close(); Helpers.toast("âŒ ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù", "error"); }
            },
            async refreshData(email, pass) {
                const res = await fetch(`${CONFIG.SCRIPT_URL}?action=login&email=${encodeURIComponent(email)}&password=${encodeURIComponent(pass)}`);
                const result = await res.json();
                if(result.status === 'success') state.update({ user: result.meta, blogs: result.blogs || [] });
            },
            download(link, ver) {
                if(!link || link === '#') return Helpers.toast("âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ø§Ø¨Ø·", "error");
                Helpers.toast(`ğŸ“¥ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ ${ver}...`);
                setTimeout(() => window.open(link, '_blank'), 1000);
            }
        };

        // ============================================
        // 4. Main Render Function
        // ============================================
        function renderApp() {
            const app = document.getElementById('app');
            document.documentElement.setAttribute('data-theme', state.theme);
            
            // Router Logic
            let template = '';
            if (state.view === 'login') template = Components.LoginView();
            else if (state.view === 'banned') template = Components.BannedView();
            else if (state.view === 'no-products') template = Components.NoProductsView();
            else if (state.view === 'dashboard') template = Components.Dashboard();

            app.innerHTML = template;
            
            // Re-initialize icons and UI states
            lucide.createIcons();
            const overlay = document.getElementById('overlay');
            if(state.sidebarOpen) overlay.classList.add('open');
            else overlay.classList.remove('open');
        }

        // Global functions for inline HTML events
        window.Actions = Actions;
        window.Helpers = Helpers;
        window.toggleSidebar = () => state.update({ sidebarOpen: !state.sidebarOpen });

        // Init
        window.onload = () => {
            const session = JSON.parse(localStorage.getItem('plugo_user_session'));
            if(session) Actions.refreshData(session.email, session.password).then(() => {
                if(state.user) state.update({ view: Helpers.getUniqueProducts().length > 0 ? 'dashboard' : 'no-products' });
                else state.update({ view: 'login' });
            }).catch(() => state.update({ view: 'login' }));
            else renderApp();
        };

    </script>
</body>
</html>